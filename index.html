<!DOCTYPE HTML>
<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <link rel='stylesheet' href='vendor/jquery-ui.css' />
    <link rel='stylesheet' href='vendor/rainbow.css' />
    <link rel='stylesheet' href='site/page.css' />
    <title>Mutiny</title>
  </head>
  <body>
    <header>
      <nav id='pages'>
        <h1>Pages</h1>
        <a href='jasmine.html'>Jasmine</a>
        <a href='performance.html'>Performance</a>
      </nav>

      <nav id='examples'>
        <h1>Examples</h1>
      </nav>
    </header>

    <article id='main'></article>

    <script src='vendor/jquery.js'></script>
    <script src='vendor/jquery-ui.js'></script>
    <script src='vendor/marked.js'></script>
    <script src='vendor/rainbow.js'></script>
    <script src='vendor/rainbow.patterns.js'></script>

    <script src='site/page.js'></script>

    <script>
      Page.include(Page.src);
    </script>

    <script>
      Mutiny.options.initOnReady = false;

      var currentPage = window.location.search.replace('?', '');

      $.each(Page.widgets, function(i, widget) {
        var link = $('<a href="index.html?%s">%s</a>'.replace(/%s/g, widget)).appendTo('#examples');
        if(currentPage === widget) {
          link.addClass('active');
        }
      });

      if(currentPage) {
        $('#main').addClass(currentPage);

        $('#main').load('examples/' + currentPage + '.html', function(data, status, xhr) {
          if(status == "error") {
            $('#main').addClass('error').html('<h1>Error ' + xhr.status + '</h1><code>' + data + '</code>');
            return;
          }

          $('#main section').wrapInner('<div class="example"/>').each(function(i, e) {
            var $e = $(e);
            var $h1 = $('<h1/>').prependTo($e).text(
                        $e.attr('id').replace(/-/g, ' ')
                      );
            /* .html() pulls out the code of the parsed Javascript.  This can cause the
            browser to re-encode ' => " and " => &quot; */
            var code = $e.find('.example').html().replace(/"/g,      "'")
                                                 .replace(/&quot;/g, '"')
                                                 .replace(/&gt;/g,   '>');
            /* Delete blank lines. */
            code = code.replace(/^$(\r\n|\n|\r)/gm, '');
            /* Delete opening whitespace */
            code = code.replace(/^  /gm, '');

            $('<pre data-language="html"/>').text(code).insertAfter($h1);
          });

          Mutiny.init();
          Rainbow.color();
        });
      } else {
        $.get('README.md', function(data) {
          $('#main').html(marked(data));
          Rainbow.color();
        });
      }
    </script>
  </body>
</html>
