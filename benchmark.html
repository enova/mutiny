<!DOCTYPE HTML>
<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <title>Mutiny Benchmark</title>
  </head>
  <body>
    <nav>
    </nav>

    <div id='results'></div>

    <script src='bower_components/benchmark/benchmark.js'></script>
    <script src='bower_components/jquery/dist/jquery.js'></script>
    <script src='site/page.js'></script>
    <script>
      Page.createLinks('nav', '#', ['format', 'arguments']);

      var $head = $('head');
      var $results = $('#results');

      function BenchmarkPlus(options){
        var suite = new Benchmark.Suite();
        $.each(options, function(name, fn){
          var $e = $('<div></div')
                     .text(name)
                     .appendTo($results);
          suite.add(name, fn, {
            onStart: function(evt){
              $e.text(name + ' starting...');
            },
            onCycle: function(evt){
              $e.text(evt.target.toString());
            },
            onComplete: function(evt){
              $e.text(evt.target.toString());
            }
          });
        });

        suite.on('complete', function(evt){
          $('<div></div>')
            .text('Fastest is ' + this.filter('fastest').pluck('name'))
            .appendTo($results);
        });

        suite.run({ async: true });
      }

      function loadFromHash(){
        $head.find('script').remove();
        $results.html('');

        var name = window.location.hash.substr(1);
        if(name.length === 0) {
          return;
        }

        var url = 'benchmark/%s.js'.replace('%s', name);
        $('<script></scr'+'ipt>')
          .attr('src', url)
          .appendTo($head);
      }

      $(window).on('hashchange', loadFromHash);
      loadFromHash();
    </script>
  </body>
</html>
