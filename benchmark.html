<!DOCTYPE HTML>
<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <title>Mutiny Benchmark</title>
    <style>
      .body {
        font-family: monospace;
        white-space: pre;
      }
    </style>
  </head>
  <body>
    <nav>
    </nav>

    <table>
      <tbody id='results'>
      </tbody>
      <tfoot>
        <th class='name'></th>
        <td class='body'></td>
        <td id='summary' class='result'></td>
      </tfoot>
    </table>

    <script src='bower_components/benchmark/benchmark.js'></script>
    <script src='bower_components/jquery/dist/jquery.js'></script>
    <script src='site/page.js'></script>
    <script>
      Page.createLinks('nav', '#', ['format', 'arguments']);

      var $head = $('head');
      var $results = $('#results');
      var $summary = $('#summary');

      function BenchmarkPlus(options){
        var suite = new Benchmark.Suite();
        $.each(options, function(name, fn){
          var $row = $('<tr></tr>')
                       .appendTo($results)
                       .append('<th class="name">' + name + '</th>',
                               '<td class="body">' + fn + '</td>');
          var $result = $('<td class="result">--</td>').appendTo($row);
          suite.add(name, fn, {
            onStart: function(evt){
              $result.text(name + ' starting...');
            },
            onCycle: function(evt){
              $result.text(evt.target.toString());
            },
            onComplete: function(evt){
              $result.text(evt.target.toString());
            }
          });
        });

        suite.on('complete', function(evt){
          $summary.text('Fastest is ' + this.filter('fastest').pluck('name'));
        });

        suite.run({ async: true });
      }

      function loadFromHash(){
        $head.find('script').remove();
        $results.html('');

        var name = window.location.hash.substr(1);
        if(name.length === 0) {
          return;
        }

        var url = 'benchmark/%s.js'.replace('%s', name);
        $('<script></scr'+'ipt>')
          .attr('src', url)
          .appendTo($head);
      }

      $(window).on('hashchange', loadFromHash);
      loadFromHash();
    </script>
  </body>
</html>
