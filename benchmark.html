<!DOCTYPE HTML>
<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <title>Mutiny</title>
  </head>
  <body>
    <div id='results'></div>

    <script src='bower_components/benchmark/benchmark.js'></script>
    <script src='bower_components/jquery/dist/jquery.js'></script>
    <script>
      var $results = $('#results');

      function BenchmarkPlus(options){
        $results.html();
        var suite = new Benchmark.Suite();
        $.each(options, function(name, fn){
          var $e = $('<div></div')
                     .text(name)
                     .appendTo($results);
          suite.add(name, fn, {
            onStart: function(evt){
              $e.text(name + ' starting...');
            },
            onCycle: function(evt){
              $e.text(evt.target.toString());
            },
            onComplete: function(evt){
              $e.text(evt.target.toString());
            }
          });
        });

        suite.on('complete', function(evt){
          $('<div></div>')
            .text('Fastest is ' + this.filter('fastest').pluck('name'))
            .appendTo($results);
        });

        suite.run({ async: true });
      }

      BenchmarkPlus({
        'inline': function(){
          function format(str) {
            for(var i=1; i < arguments.length; i++) {
              var regex = new RegExp("\\{" + (i-1) + "\\}", "gm");
              str = str.replace(regex, arguments[i]);
            }

            return str;
          }

          return function(){
            format('{0} {1} {2} {3}', 'foo', 'bar', 'baz', 'boo');
          };
        }(),

        'precached': function(){
          var regexes = [];
          for(var i=0; i < 10; i++){
            regexes[i] = new RegExp("\\{" + i + "\\}", "gm");
          }
          function format(str) {
            for(var i=1; i < arguments.length; i++) {
              str = str.replace(regexes[i-1], arguments[i]);
            }

            return str;
          }

          return function(){
            format('{0} {1} {2} {3}', 'foo', 'bar', 'baz', 'boo');
          }
        }(),

        'cache on demand': function(){
          var regexes = [];
          function format(str) {
            for(var i=1; i < arguments.length; i++) {
              var r = i-1;
              var regex = regexes[r];
              if(!regex){
                regex = regexes[r] = new RegExp("\\{" + r + "\\}", "gm");
              }
              str = str.replace(regex, arguments[i]);
            }

            return str;
          }

          return function(){
            format('{0} {1} {2} {3}', 'foo', 'bar', 'baz', 'boo');
          }
        }()
      });
    </script>
  </body>
</html>
