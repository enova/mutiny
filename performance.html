<!DOCTYPE html>
<html>
<head>
  <title>Mutiny Performance</title>
</head>

<body>
  <table>
    <thead>
      <tr><th>Test</th><th>Duration</th></tr>
    </thead>
    <tbody id='tbody'>
    </tbody>
  </table>

  <script src='vendor/jquery.js'></script>
  <script src='vendor/jquery-ui.js'></script>
  <script src='site/page.js'></script>
  <script>Page.include(Page.src);</script>

  <script>
    function createElement(tag, options){
      var element = document.createElement(tag);
      for(var key in (options || {})){
        element[key] = options[key];
      }
      return element;
    }

    var tbody = document.getElementById('tbody');

    var tests = [];
    function time(name, iterations, func){
      var tr = createElement('tr');
      tbody.appendChild(tr);
      tr.appendChild(createElement('td', {textContent: name}));
      var durationEl = createElement('td', {textContent: 'Loading...'});
      tr.appendChild(durationEl);

      tests.push(function(){
        var start = +new Date();
        for(var i=0; i < iterations; i++){
          func();
        }
        var end = +new Date();
        durationEl.textContent = end - start;
      });
    }

    function runTests(i){
      i = i || 0;
      if(i < tests.length){
        setTimeout(function(){
          tests[i]();
          runTests(i+1);
        }, 50);
      }
    }

    window.onload = function(){
      runTests(0);
    };
  </script>

  <script>
    time('Mutiny.init()', 10000, function(){
      Mutiny.init();
    });

    time('Mutiny.init($e)', 10000, function(){
      var $e = $('<div data-mutiny-toggler="" />');
      Mutiny.init($e);
    });

    time('format()', 1000000, function(){
      format('{0} {1} {2} {2} {1} {0}', 'foo', 'bar', 'baz');
    });
  </script>
</body>
</html>
